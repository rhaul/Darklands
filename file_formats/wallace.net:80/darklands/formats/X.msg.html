<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head><script type="text/javascript" src="/static/js/analytics.js?v=1519377156.0" charset="utf-8"></script>

<script type="text/javascript">archive_analytics.values.service='wb';archive_analytics.values.server_name='wwwb-app43.us.archive.org';archive_analytics.values.server_ms=451;</script><script type="text/javascript" src="/static/js/wbhack.js?v=1519377156.0" charset="utf-8"></script>

<script type="text/javascript">
__wbhack.init('https://web.archive.org/web');
</script>
<link rel="stylesheet" type="text/css" href="/static/css/banner-styles.css?v=1519377156.0" />
<link rel="stylesheet" type="text/css" href="/static/css/iconochive.css?v=1519377156.0" />

<!-- End Wayback Rewrite JS Include -->
		<meta content="text/html; charset=iso-8859-1" http-equiv="content-type">
		<title>
		File Format: Darklands message file</title>
		<link href="/web/20091112110236cs_/http://wallace.net:80/darklands/formats/file_format.css" rel="stylesheet" title="File Format" type="text/css">
	</head>
	<body>
		<h1>Darklands message file</h1>
		<p>Files with this format: "<code>*.msg</code>".</p>
		<p>
Contains text and possibly other information about screens (cards).
</p>
		<p>
It is difficult to tell if a "card" refers to the entire file, or
to one of the string entries in the file.  The terms are confusingly
used interchangably in this file.
</p>
		<p>
Most, if not all, "<code>.msg</code>" files are found within
the one cat file <a href="catalogs/msgfiles.html">msgfiles</a>.
</p>
		<h1 class="toc">Table of Contents</h1>
		<h2 class="toc-category">Offsets</h2>
		<div class="toc-entry">
			<a href="#offset-0x00">starting at 0x00</a>
		</div>
		<h2 class="toc-category">Structures</h2>
		<div class="toc-entry">
			<a href="#structdef-card">card</a>
		</div>
		<hr>
		<h1>Offsets</h1>
		<h2>
			<a name="offset-0x00">Offset: starting at 0x00</a>
		</h2>
		<dl>
			<dt>
				<span class="var-at">
					<code>0x00</code>: </span>
				<span class="var-name">
					<a name="variable-num_cards">
						<strong>num_cards: </strong>
					</a>
				</span>
				<span class="var-datatype">byte</span>
			</dt>
			<dd>
				<span class="var-description">Number of cards.</span>
			</dd>
			<dt>
				<span class="var-at">
					<code>0x01</code>: </span>
				<span class="var-name">
					<a name="variable-card_definitions">
						<strong>card_definitions: </strong>
					</a>
				</span>
				<span class="var-datatype">array[ <a href="#variable-num_cards">num_cards</a> ] of struct <a href="#structdef-card">card</a>
				</span>
			</dt>
			<dd>
				<span class="var-description">Card definitions.</span>
			</dd>
		</dl>
		<hr>
		<h1>Structures</h1>
		<h2>
			<a name="structdef-card">Structure: card</a>
		</h2>
		<p>A definition of an alchemical formula.</p>
		<dl>
			<dt>
				<span class="var-at">
					<code>0x00</code>: </span>
				<span class="var-name"><ins>textOffsY:</ins></span>
				<span class="var-datatype">
					<del><i>unknown</i> (5 bytes)</del></span>
					byte
			</dt>
<ins>
            <dd>
                <span class="var-description">
				Left border of card text. Starting at the edge of left border -2 pixels.
				</span>
			</dd>

            <dt>
                <span class="var-at">
                    <code>0x01</code>: </span>
                <span class="var-name"><ins>textOffsX:</ins></span>
                <span class="var-datatype">
                    byte</span>
            </dt>
            <dd>
                <span class="var-description">
                Top border of card text. Starting at the edge of top border -1 pixel.
                </span>
            </dd>

            <dt>
                <span class="var-at">
                    <code>0x02</code>: </span>
                <span class="var-name"></span>
                <span class="var-datatype">
                    unknown (byte)</span>
            </dt>

            <dt>
                <span class="var-at">
                    <code>0x03</code>: </span>
                <span class="var-name">textMaxX:</span>
                <span class="var-datatype">
                    byte</span>
            </dt>
            <dd>
                <span class="var-description">
                Text maximum X. (Width of the text column = textMaxX - textOffsX)
                </span>
            </dd>

            <dt>
                <span class="var-at">
                    <code>0x04</code>: </span>
                <span class="var-name"></span>
                <span class="var-datatype">
                    unknown (byte)</span>
            </dt>
</ins>

			<dd>
				<span class="var-description">
					<ul class="notes">
						<li class="note">Many of these are {0x0a, 0x0a, 0x00, 0xf0, 0x00}.</li>
						<del><li class="note">Possibly these have to do with colors, images, or music?</li></del>
						<ins>
						<li class="note">Unknown bytes are 0x0 for all but 2 cards.</li>
						<li class="note">First (extreme) exception is $MCGUF07.MSG, it has 76 cards, all without text and nearly all of them have nonzero unk1 or unk 2.</li>
						<li class="note">Second one is $RAUBI05.MSG, there id only one nonzero unk2. Typo probably?</li>
						</ins>
					</ul>
				</span>
			</dd>
			<dt>
				<span class="var-at">
					<code>0x05</code>: </span>
				<span class="var-name">
					<a name="variable-contents">
						<strong>contents: </strong>
					</a>
				</span>
				<span class="var-datatype">string (null-delimited)</span>
			</dt>
			<dd>
				<span class="var-description">Textual contents of the screen.<ul class="notes">
						<li class="note">
					Screens are always a preamble of text, sometimes followed by a list of up to ten options.
					If there are not that many choices, bogus entries (usually just numbered 1-10) fill the option slots.
				</li>
						<li class="note">
					Some cards appear to be standardized (always ten options, with potion/saint/leave options in the same places).
				</li>
						<li class="note">
					0x0a seems to be a newline, 0x14 seems to be a paragraph break.
					These are almost always used together as a pair {0x0a, 0x14},
					between every paragraph and each option.
				</li>
						<li class="note">Usually the valid options start with {0x0a, 0x14}, but sometimes have an extra 0x14 or 0x15 appended (spacing?).</li>
						<li class="note">0x15 is unknown.  Usually it follows the {0x0a, 0x14}, so it's probably whitespace?</li>
						<li class="note">There is always an 0x1d between the "..." and the text of an option.</li>
						<li class="note">An 0x10 immediately precedes the "..." for options that offer a popup potion selection.</li>
						<li class="note">An 0x16 immediately precedes the "..." for options that offer a popup saint selection.</li>
						<li class="note">An 0x06 immediately precedes the "..." for options that would cause the party to enter battle immediately.</li>
					</ul>
				</span>
			</dd>
		</dl>
	</body>
</html>
