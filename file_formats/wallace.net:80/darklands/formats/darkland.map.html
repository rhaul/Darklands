<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head><script type="text/javascript" src="/static/js/analytics.js?v=1519377156.0" charset="utf-8"></script>

<script type="text/javascript">archive_analytics.values.service='wb';archive_analytics.values.server_name='wwwb-app23.us.archive.org';archive_analytics.values.server_ms=311;</script><script type="text/javascript" src="/static/js/wbhack.js?v=1519377156.0" charset="utf-8"></script>

<script type="text/javascript">
__wbhack.init('https://web.archive.org/web');
</script>
<link rel="stylesheet" type="text/css" href="/static/css/banner-styles.css?v=1519377156.0" />
<link rel="stylesheet" type="text/css" href="/static/css/iconochive.css?v=1519377156.0" />

<!-- End Wayback Rewrite JS Include -->
		<meta content="text/html; charset=iso-8859-1" http-equiv="content-type">
		<title>
		File Format: Darklands world map</title>
		<link href="/web/20091112194430cs_/http://wallace.net:80/darklands/formats/file_format.css" rel="stylesheet" title="File Format" type="text/css">
	</head>
	<body>
		<h1>Darklands world map</h1>
		<p>Files with this format: "<code>darkland.map</code>".</p>
		<p>
	Contains the wilderness map, with everything except for
	the dynamically generated locations
	(all non-cities listed in <code>darkland.loc</code>).
	</p>
		<p>
	The map is constructed from tiles contained in two <code>.pic</code> files:
	"<code>mapicons.pic</code>" and "<code>mapicon2.pic</code>".
	</p>
		<h1 class="toc">Table of Contents</h1>
		<h2 class="toc-category">Offsets</h2>
		<div class="toc-entry">
			<a href="#offset-0x00">starting at 0x00</a>
		</div>
		<hr>
		<h1>Offsets</h1>
		<h2>
			<a name="offset-0x00">Offset: starting at 0x00</a>
		</h2>
		<dl>
			<dt>
				<span class="var-at">
					<code>0x00</code>: </span>
				<span class="var-name">
					<a name="variable-max_x_coord">
						<strong>max_x_coord: </strong>
					</a>
				</span>
				<span class="var-datatype">word</span> = 0x147</dt>
			<dd>
				<span class="var-description">Number of locations.<ul class="notes">
						<li class="note">This word is stored high-byte first</li>
					</ul>
				</span>
			</dd>
			<dt>
				<span class="var-at">
					<code>0x02</code>: </span>
				<span class="var-name">
					<a name="variable-max_y_coord">
						<strong>max_y_coord: </strong>
					</a>
				</span>
				<span class="var-datatype">word</span> = 0x3a3</dt>
			<dd>
				<span class="var-description">Number of locations.<ul class="notes">
						<li class="note">This word is stored high-byte first</li>
					</ul>
				</span>
			</dd>
			<dt>
				<span class="var-at">
					<code>0x04</code>: </span>
				<span class="var-name">
					<a name="variable-row_offsets">
						<strong>row_offsets: </strong>
					</a>
				</span>
				<span class="var-datatype">array[ <a href="#variable-max_y_coord">max_y_coord</a> ] of <del>word</del> <ins>double word</ins></span>
			</dt>
			<dd>
				<span class="var-description">File offsets to row data.</span>
			</dd>
			<dt>
				<span class="var-at">[next]: </span>
				<span class="var-name">
					<a name="variable-map_data">
						<strong>map_data: </strong>
					</a>
				</span>
				<span class="var-datatype">array[ <a href="#variable-max_y_coord">max_y_coord</a> ] of array[ <em></em> ] of byte</span>
			</dt>
			<dd>
				<span class="var-description">Map data.<ul class="notes">
						<li class="note">
					This data is RLE compressed: each byte represents 1-7 map tiles.
				</li>
						<li class="note">
					The top three bits are the repeat count, 
					and are always at least one (<code>001xxxxx</code>).
				</li>
						<li class="note">
					The next bit is the palette set:
					<code>0</code> for "<code>mapicons.pic</code>",
					<code>1</code> for "<code>mapicon2.pic</code>".
				</li>
						<li class="note">
					The four least bits indicate which row the tile comes from in the palette set.
				</li>
						<li class="note">
					Which column the map tile comes from depends on the four diagonally adjacent tiles:
					<br>
					the 1's bit comes from the northwest tile<del>'s row's 8's bit</del> <ins> if it has the same palette and row values</ins>;
					<br>
					the 2's bit comes from the northeast tile<del>'s row's 4's bit</del> <ins> if it has the same palette and row values</ins>;
					<br>
					the 4's bit comes from the southwest tile<del>'s row's 2's bit</del> <ins> if it has the same palette and row values</ins>;
					<br>
					the 8's bit comes from the southeast tile<del>'s row's 1's bit</del> <ins> if it has the same palette and row values</ins>.
				</li>
						<li class="note"><ins>
					Odd lines (<code>y%2 == 1</code>) are shifted by half to the right. Therefore ie. for <code>y==2</code> are north adjacent tiles coordinates <code>x-1, y-1</code> and <code>x, y-1</code>, and for <code>y==3</code
> are north adjacent tiles coordinates <code>x, y-1</code> and <code>x+1, y-1</code>.
				</ins></li>
					</ul>
				</span>
			</dd>
		</dl>
	</body>
</html>
